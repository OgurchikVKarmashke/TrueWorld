#save_menu.py
from ui.ui_utils import print_header, press_enter_to_continue, loading_screen
from datetime import datetime

def save_menu(game_state):
    """
    –ú–µ–Ω—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä—ã (–æ–¥–∏–Ω —Å–ª–æ—Ç)
    """
    while True:
        print_header("üíæ –ú–µ–Ω—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
        save_info = game_state["save_system"].get_save_info(1)
        if save_info:
            time = datetime.fromisoformat(save_info["timestamp"]).strftime("%d.%m.%Y %H:%M")
            print("üìÅ –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ª–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:")
            print(f"   üè∞ –≠—Ç–∞–∂: {save_info['tower_level']}")
            print(f"   üïí –í—Ä–µ–º—è: {time}")
            print(f"   üë• –ì–µ—Ä–æ–µ–≤: {save_info['hero_count']}")
            print(f"   üí∞ –ó–æ–ª–æ—Ç–æ: {save_info['gold']}")
        else:
            print("üìÅ –°–ª–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è - –ü—É—Å—Ç–æ")
            print("   ‚ÑπÔ∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–≥—Ä—É —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è")
        print()
        
        print("1. üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É")
        if save_info:
            print("2. üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É")
        print("0. ‚Ü©Ô∏è –ù–∞–∑–∞–¥")
        print()
        
        try:
            choice = int(input("üéØ –í–∞—à –≤—ã–±–æ—Ä: "))
        except ValueError:
            press_enter_to_continue()
            continue
        
        if choice == 0:
            break
        elif choice == 1:
            # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
            if game_state["save_system"].save_game(game_state, 1):
                loading_screen(2, "üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã")
                print("‚úÖ –ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!")
            else:
                print("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!")
            press_enter_to_continue()
        elif choice == 2 and save_info:
            # –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            if game_state["save_system"].load_game(game_state, 1):
                loading_screen(2, "üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã")
                print("‚úÖ –ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!")
            else:
                print("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏!")
            press_enter_to_continue()
        else:
            print("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä!")
            press_enter_to_continue()