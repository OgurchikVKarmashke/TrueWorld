# ui.storage_ui.py
from ui.ui_utils import print_header, press_enter_to_continue
from systems.items_system import ItemType

def storage_menu(game_state):
    storage = game_state["storage"]
    
    while True:
        print_header("üì¶ –°–∫–ª–∞–¥")
        print(f"–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: {storage.get_item_count()}/{storage.capacity}")
        print()
        
        if not storage.items:
            print("–°–∫–ª–∞–¥ –ø—É—Å—Ç!")
            print()
            print("1. –ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã")
            print("0. –ù–∞–∑–∞–¥")
        else:
            # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –ø–æ —Ç–∏–ø–∞–º
            item_types = {
                "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã": storage.get_items_by_type("–ú–∞—Ç–µ—Ä–∏–∞–ª"),
                "–û—Ä—É–∂–∏–µ": storage.get_items_by_type("–û—Ä—É–∂–∏–µ"),
                "–ë—Ä–æ–Ω—è": storage.get_items_by_type("–ë—Ä–æ–Ω—è"),
                "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã": storage.get_items_by_type("–ê–∫—Å–µ—Å—Å—É–∞—Ä")
            }
            
            for category, items in item_types.items():
                if items:
                    print(f"=== {category} ===")
                    for item_id, item in items.items():
                        if item.stackable:
                            print(f"‚Ä¢ {item.name} x{item.quantity} - {item.rarity.value}")
                        else:
                            print(f"‚Ä¢ {item.name} - {item.rarity.value}")
                    print()
            
            print("0. –ù–∞–∑–∞–¥")
        
        try:
            choice = input("–í–∞—à –≤—ã–±–æ—Ä: ")
            
            if choice == "0":
                break
            elif choice == "1" and not storage.items:
                # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
                from systems.items_system import ItemManager
                item_manager = ItemManager()
                
                test_items = [
                    item_manager.create_item("iron_ore", 10),
                    item_manager.create_item("steel_bar", 3),
                    item_manager.create_item("magic_crystal", 1),
                    item_manager.create_item("iron_sword", 1)
                ]
                
                for item in test_items:
                    storage.add_item(item)
                
                print("–¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã!")
                press_enter_to_continue()
                
        except ValueError:
            press_enter_to_continue()