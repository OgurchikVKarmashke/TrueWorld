#buildings_menu.py
from ui.ui_utils import print_header, press_enter_to_continue, loading_screen
from systems.summon_system import summon_hero
from ui.building_manager import manage_buildings
from ui.research_manager import manage_research
from ui.synthesis_room import manage_synthesis

def buildings_menu(game_state):
    """
    –ú–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–¥–∞–Ω–∏—è–º–∏
    """
    while True:
        print_header("üèõÔ∏è –ö–æ–º–ø–ª–µ–∫—Å –∑–¥–∞–Ω–∏–π")
        print("–í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è:")
        print()
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∑–¥–∞–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∞–∂–∞
        tower_level = game_state["tower_level"]
        available_buildings = []
        
        # –í—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã
        available_buildings.append(("–ó–∞–ª –ø—Ä–∏–∑—ã–≤–∞ –≥–µ—Ä–æ–µ–≤", True, None))
        available_buildings.append(("–ö–æ–º–Ω–∞—Ç–∞ —Å–∏–Ω—Ç–µ–∑–∞", True, None))
        
        # –°–∫–ª–∞–¥ –¥–æ—Å—Ç—É–ø–µ–Ω —Å 3 —ç—Ç–∞–∂–∞
        available_buildings.append(("–°–∫–ª–∞–¥", tower_level >= 3, "–≠—Ç–∞–∂ 3+"))
        
        # –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Å 5 —ç—Ç–∞–∂–∞
        available_buildings.append(("–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è", tower_level >= 5, "–≠—Ç–∞–∂ 5+"))
        
        # –°—Ç–æ–ª–æ–≤–∞—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Å 7 —ç—Ç–∞–∂–∞
        available_buildings.append(("–°—Ç–æ–ª–æ–≤–∞—è", tower_level >= 7, "–≠—Ç–∞–∂ 7+"))
        
        # –ö—É–∑–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Å 10 —ç—Ç–∞–∂–∞
        available_buildings.append(("–ö—É–∑–Ω–∏—Ü–∞", tower_level >= 10, "–≠—Ç–∞–∂ 10+"))
        
        # –£–ª—É—á—à–µ–Ω–∏–µ –∑–¥–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø–Ω–æ —Å 1 —ç—Ç–∞–∂–∞
        available_buildings.append(("–£–ª—É—á—à–∏—Ç—å –∑–¥–∞–Ω–∏—è", tower_level >= 1, "–≠—Ç–∞–∂ 1+"))
        
        # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∑–¥–∞–Ω–∏—è
        menu_items = []
        counter = 1
        for name, available, requirement in available_buildings:
            if available:
                menu_items.append((counter, name))
                status_icon = "üõ†Ô∏è" if name == "–£–ª—É—á—à–∏—Ç—å –∑–¥–∞–Ω–∏—è" else "üè†"
                print(f"{counter}. {status_icon} {name}")
                counter += 1
        
        print("0. ‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ª–æ–±–±–∏")
        print()
        
        try:
            choice = int(input("–í–∞—à –≤—ã–±–æ—Ä: "))
        except ValueError:
            press_enter_to_continue()
            continue
        
        if choice == 0:
            break
        
        # –ù–∞—Ö–æ–¥–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—É–Ω–∫—Ç
        selected = None
        for num, name in menu_items:
            if num == choice:
                selected = name
                break
        
        if selected == "–ó–∞–ª –ø—Ä–∏–∑—ã–≤–∞ –≥–µ—Ä–æ–µ–≤":
            summon_hall(game_state)
        elif selected == "–ö–æ–º–Ω–∞—Ç–∞ —Å–∏–Ω—Ç–µ–∑–∞":
            manage_synthesis(game_state)
        elif selected == "–£–ª—É—á—à–∏—Ç—å –∑–¥–∞–Ω–∏—è":
            manage_buildings(game_state)
        elif selected == "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è":
            manage_research(game_state)
        elif selected == "–°–∫–ª–∞–¥":
            print("–°–∫–ª–∞–¥ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...")
            press_enter_to_continue()
        elif selected == "–°—Ç–æ–ª–æ–≤–∞—è":
            print("–°—Ç–æ–ª–æ–≤–∞—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...")
            press_enter_to_continue()
        elif selected == "–ö—É–∑–Ω–∏—Ü–∞":
            print("–ö—É–∑–Ω–∏—Ü–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...")
            press_enter_to_continue()
        else:
            print("–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä!")
            press_enter_to_continue()

def summon_hall(game_state):
    """
    –ó–∞–ª –ø—Ä–∏–∑—ã–≤–∞ –≥–µ—Ä–æ–µ–≤
    """
    while True:
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–∏–º–∏—Ç–µ –≥–µ—Ä–æ–µ–≤
        dormitory = game_state["buildings"].get_building("dormitory")
        current_heroes = len(game_state["heroes"])
        max_heroes = dormitory.get_capacity()
        
        print_header("–ó–∞–ª –ø—Ä–∏–∑—ã–≤–∞ –≥–µ—Ä–æ–µ–≤")
        print(f"–ó–æ–ª–æ—Ç–æ: {game_state['wallet'].gold}")
        print(f"–ö—Ä–∏—Å—Ç–∞–ª–ª—ã: {game_state['wallet'].crystals}")
        print(f"–ì–µ—Ä–æ–µ–≤: {current_heroes}/{max_heroes}")
        print()
        print("1. –ü—Ä–∏–∑—ã–≤ –∑–∞ –∑–æ–ª–æ—Ç–æ (50 –∑–æ–ª–æ—Ç–∞)")
        print("2. –ü—Ä–∏–∑—ã–≤ –∑–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ)")
        print("0. –ù–∞–∑–∞–¥")
        print()
        
        try:
            choice = int(input("–í–∞—à –≤—ã–±–æ—Ä: "))
        except ValueError:
            press_enter_to_continue()
            continue
        
        if choice == 0:
            break
        elif choice == 1:
            if current_heroes >= max_heroes:
                print("–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≥–µ—Ä–æ–µ–≤!")
                print("–£–ª—É—á—à–∏—Ç–µ –û–±—â–µ–∂–∏—Ç–∏–µ, —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç")
                press_enter_to_continue()
            else:
                summon_hero(game_state)
        elif choice == 2:
            print("–ü—Ä–∏–∑—ã–≤ –∑–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –±—É–¥—É—â–µ–º!")
            press_enter_to_continue()
        else:
            print("–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä!")
            press_enter_to_continue()