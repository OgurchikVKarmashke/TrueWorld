# party_manager.py
from ui.ui_utils import print_header, press_enter_to_continue

def view_party(game_state):
    """
    –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥–µ—Ä–æ—è—Ö
    """
    print_header("–í–∞—à–∏ –≥–µ—Ä–æ–∏")
    
    if not game_state["heroes"]:
        print("üéØ –û—Ç—Ä—è–¥ –ø—É—Å—Ç")
        print("‚û°Ô∏è –ü—Ä–∏–∑–æ–≤–∏—Ç–µ –≥–µ—Ä–æ–µ–≤ –≤ –∑–∞–ª–µ –ø—Ä–∏–∑—ã–≤–∞ –≥–µ—Ä–æ–µ–≤")
        print("üí° –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–∑—ã–≤–∞: 50 –∑–æ–ª–æ—Ç–∞")
        press_enter_to_continue()
        return
    
    dormitory = game_state["buildings"].get_building("dormitory")
    current_capacity = len(game_state["heroes"])
    max_capacity = dormitory.get_capacity()
    
    print(f"üë• –ì–µ—Ä–æ–µ–≤: {current_capacity}/{max_capacity}")
    print("=" * 50)
    
    for i, hero in enumerate(game_state["heroes"], 1):
        star_symbol = "‚òÖ" * hero.star
        
        # –ü–æ–ª—É—á–∞–µ–º —Ä–æ–ª—å –≥–µ—Ä–æ—è
        role = ""
        if hasattr(game_state.get("role_system", None), 'get_hero_role'):
            hero_role = game_state["role_system"].get_hero_role(hero)
            if hero_role:
                role = f" | üëë {hero_role}"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–Ω—è—Ç –ª–∏ –≥–µ—Ä–æ–π –≤ –≥—Ä—É–ø–ø–∞—Ö
        in_party = False
        if "party_system" in game_state:
            parties = game_state["party_system"]["parties"]
            for party_data in parties.values():
                if id(hero) in party_data.get("heroes", []):
                    in_party = True
                    break
        
        status = "‚úÖ –°–≤–æ–±–æ–¥–µ–Ω"
        if role:
            status = f"üëë –ù–∞ —Ä–æ–ª–∏"
        elif in_party:
            status = "‚öîÔ∏è –í –≥—Ä—É–ø–ø–µ"
        
        print(f"{i}. {hero.name} {star_symbol} | {status}{role}")
        print(f"   üìä –£—Ä–æ–≤–µ–Ω—å: {hero.level}")
        print(f"   ‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: {hero.health_current}/{hero.health_max}")
        print(f"   üîµ –ú–∞–Ω–∞: {hero.mana_current}/{hero.mana_max}")
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫—Ä—ã—Ç—ã–µ —Å—Ç–∞—Ç—ã, –µ—Å–ª–∏ –∏–∑—É—á–µ–Ω–æ "–ü–æ–Ω–∏–º–∞–Ω–∏–µ –≥–µ—Ä–æ–µ–≤"
        if game_state.get("hero_understanding") or game_state.get("flags", {}).get("hero_understanding"):
            print(f"   {hero.get_hidden_stats(game_state)}")
        print("-" * 50)
    
    press_enter_to_continue()