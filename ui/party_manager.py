# party_manager.py
# ui.party_manager.py
from ui.ui_utils import print_header, press_enter_to_continue
from ui.visual_effects import VisualEffects

def view_party(game_state):
    """
    –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¢–û–õ–¨–ö–û –ñ–ò–í–´–• –≥–µ—Ä–æ—è—Ö
    """
    print_header("–í–∞—à–∏ –≥–µ—Ä–æ–∏")
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∂–∏–≤—ã—Ö –≥–µ—Ä–æ–µ–≤
    living_heroes = [h for h in game_state["heroes"] if h.is_alive]
    
    if not living_heroes:
        print("üéØ –í –≤–∞—à–µ–º –ª–æ–±–±–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≥–µ—Ä–æ–∏")
        print("üí° –ü—Ä–∏–∑–æ–≤–∏—Ç–µ –Ω–æ–≤—ã—Ö –≥–µ—Ä–æ–µ–≤ –≤ –∑–∞–ª–µ –ø—Ä–∏–∑—ã–≤–∞ –≥–µ—Ä–æ–µ–≤")
        press_enter_to_continue()
        return
    
    dormitory = game_state["buildings"].get_building("dormitory")
    current_capacity = len(living_heroes)  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –∂–∏–≤—ã—Ö
    max_capacity = dormitory.get_capacity()
    
    print(f"üë• –ì–µ—Ä–æ–µ–≤: {current_capacity}/{max_capacity}")
    print("=" * 50)
    
    for i, hero in enumerate(living_heroes, 1):  # –ò—Å–ø–æ–ª—å–∑—É–µ–º living_heroes –≤–º–µ—Å—Ç–æ game_state["heroes"]
        star_display = VisualEffects.get_star_display(hero.star)
        
        # –ü–æ–ª—É—á–∞–µ–º —Ä–æ–ª—å –≥–µ—Ä–æ—è
        role = ""
        if hasattr(game_state.get("role_system", None), 'get_hero_role'):
            hero_role = game_state["role_system"].get_hero_role(hero)
            if hero_role:
                role = f" | üëë {hero_role}"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–Ω—è—Ç –ª–∏ –≥–µ—Ä–æ–π –≤ –≥—Ä—É–ø–ø–∞—Ö
        in_party = False
        if "party_system" in game_state:
            parties = game_state["party_system"]["parties"]
            for party_data in parties.values():
                if id(hero) in party_data.get("heroes", []):
                    in_party = True
                    break
        
        status = "‚úÖ –°–≤–æ–±–æ–¥–µ–Ω"
        if role:
            status = f"üëë –ù–∞ —Ä–æ–ª–∏"
        elif in_party:
            status = "‚öîÔ∏è –í –≥—Ä—É–ø–ø–µ"
        
        print(f"{i}. {hero.name} {star_display} | {status}{role}")
        print(f"   üìä –£—Ä–æ–≤–µ–Ω—å: {hero.level}")
        print(f"   ‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: {hero.health_current}/{hero.health_max}")
        print(f"   üîµ –ú–∞–Ω–∞: {hero.mana_current}/{hero.mana_max}")
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫—Ä—ã—Ç—ã–µ —Å—Ç–∞—Ç—ã, –µ—Å–ª–∏ –∏–∑—É—á–µ–Ω–æ "–ü–æ–Ω–∏–º–∞–Ω–∏–µ –≥–µ—Ä–æ–µ–≤"
        if game_state.get("hero_understanding") or game_state.get("flags", {}).get("hero_understanding"):
            print(f"   {hero.get_hidden_stats(game_state)}")
        print("-" * 50)
    
    press_enter_to_continue()
