# summon_system.py
from ui.ui_utils import loading_screen, press_enter_to_continue, print_header
from systems.hero_system import Hero
import random

def summon_hero(game_state):
    """
    –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–∑—ã–≤–∞ –≥–µ—Ä–æ–µ–≤ –∑–∞ –∑–æ–ª–æ—Ç–æ
    """
    # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–∏–º–∏—Ç–µ –≥–µ—Ä–æ–µ–≤
    dormitory = game_state["buildings"].get_building("dormitory")
    current_heroes = len(game_state["heroes"])
    max_heroes = dormitory.get_capacity()  # ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º get_capacity()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏ –ª–∏–º–∏—Ç
    if current_heroes >= max_heroes:
        print_header("–ü—Ä–∏–∑—ã–≤ –≥–µ—Ä–æ—è")
        print("–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≥–µ—Ä–æ–µ–≤!")
        print(f"–ì–µ—Ä–æ–µ–≤: {current_heroes}/{max_heroes}")
        print("–£–ª—É—á—à–∏—Ç–µ –û–±—â–µ–∂–∏—Ç–∏–µ, —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç")
        press_enter_to_continue()
        return
    
    cost = 50  # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
    
    print_header("‚ú® –ü—Ä–∏–∑—ã–≤ –≥–µ—Ä–æ—è")
    print(f"üí∞ –ó–æ–ª–æ—Ç–æ: {game_state['wallet'].gold}")
    print(f"üíé –ö—Ä–∏—Å—Ç–∞–ª–ª—ã: {game_state['wallet'].crystals}")
    print(f"üë• –ì–µ—Ä–æ–µ–≤: {current_heroes}/{max_heroes}")
    print(f"üíµ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–∑—ã–≤–∞: {cost} –∑–æ–ª–æ—Ç–∞")
    print()
    
    if game_state["wallet"].subtract_gold(cost):
        loading_screen(2, "üåÄ –ü—Ä–∏–∑—ã–≤ –≥–µ—Ä–æ—è")
        
        # –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê –ó–í–Å–ó–î
        star_level = calculate_star_chance()
        new_hero = Hero(star=star_level)
        game_state["heroes"].append(new_hero)
        
        print_header("üéâ –ì–µ—Ä–æ–π –ø—Ä–∏–∑–≤–∞–Ω!")
        print(f"–ì–µ—Ä–æ–π {new_hero.name} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –≤–∞—à–µ–º—É –æ—Ç—Ä—è–¥—É!")
        print(f"‚ú® –ó–≤—ë–∑–¥–Ω–æ—Å—Ç—å: {star_level}‚òÖ")
        print(f"üìà –£—Ä–æ–≤–µ–Ω—å: 1")
        print("üé≠ –•–∞—Ä–∞–∫—Ç–µ—Ä –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å–∫—Ä—ã—Ç—ã")
        print(f"üë• –ì–µ—Ä–æ–µ–≤: {len(game_state['heroes'])}/{max_heroes}")
        
    else:
        print("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞ –¥–ª—è –ø—Ä–∏–∑—ã–≤–∞!")
    
    press_enter_to_continue()
    game_state["save_system"].save_game(game_state, 1)

def calculate_star_chance():
    """
    –°–∏—Å—Ç–µ–º–∞ —à–∞–Ω—Å–æ–≤ –∑–≤—ë–∑–¥:
    1‚òÖ - 70% (–æ–±—ã—á–Ω—ã–π)
    2‚òÖ - 25% (–Ω–µ–æ–±—ã—á–Ω—ã–π) 
    3‚òÖ - 4.9% (—Ä–µ–¥–∫–∏–π)
    4‚òÖ - 0.1% (—ç–ø–∏—á–µ—Å–∫–∏–π)
    """
    roll = random.random() * 100  # 0-100
    
    if roll < 70:
        return 1
    elif roll < 95:  # 70 + 25 = 95
        return 2
    elif roll < 99.9:  # 95 + 4.9 = 99.9
        return 3
    else:
        return 4

def summon_crystal_hero(game_state):
    """
    –ü—Ä–µ–º–∏—É–º –ø—Ä–∏–∑—ã–≤ –∑–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã (–¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –∑–≤—ë–∑–¥)
    """
    # –ë—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–∑–∂–µ
    print_header("–ü—Ä–∏–∑—ã–≤ –∑–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã")
    print("–°–∏—Å—Ç–µ–º–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...")
    print("–ó–¥–µ—Å—å –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≥–µ—Ä–æ–∏ 5-7‚òÖ")
    press_enter_to_continue()